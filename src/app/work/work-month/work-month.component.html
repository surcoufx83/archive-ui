@if (!usersettingsObj || !selectedDay) {
<ui-centered-busy-indicator></ui-centered-busy-indicator>
}

@else {

<div class="container">

  <div class="pt-4 pt-md-2 mb-2">
    <!-- The page header with day back and forward buttons and busy indicator -->
    <app-work-month-header [selectedMonth]="selectedMonth" [busy]="monthLoading"></app-work-month-header>
  </div>

  <div class="pt-md-2 mb-2">

    <div class="row g-2">
      <!-- container with info cards -->

      <div class="col-12 col-md-4">
        <!-- card 1: Month info -->
        <app-work-month-info-box [workMonth]="monthObj">

        </app-work-month-info-box>
      </div>

      <div class="d-none d-md-block col-md-4">
        <!-- card 2:  -->
      </div>

      <div class="col-12 col-md-4">
        <!-- card 3:  -->

      </div>

      <!-- container with info cards -->
    </div>

  </div>

  <div class="pt-4 pt-md-2 mb-2">
    <!-- Calendar container -->
    <app-h3 [title]="i18nstr.workday.tracking.title" [containercss]="'pt-4'" id="scroll-anchor"></app-h3>



  </div>

</div>

}

<ng-container *ngIf="usersettingsObj != undefined && selectedDay != undefined">

  <ng-container *ngIf="!monthLoading && monthObj != undefined && selectedDay != undefined">

    <div class="container pt-md-2 mb-2">

      <div class="row g-2">
        <!-- container with info cards -->

        <div class="col-12 col-md-4">
          <!-- card 1: container month info -->

        </div><!-- card 1: container month info -->

        <div class="col-12 col-md-4">
          <!-- card 2: time booked -->
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <app-icon [iconClass]="icons['stopwatch']" [marginEnd]="1"></app-icon>
                {{ i18nstr.workmonth.cards.time.title }}
              </h5>
            </div>
            <div class="card-body">
              <div class="d-flex justify-content-between mb-2">
                <div class="fs-7">
                  {{ i18nstr.workmonth.cards.time.takeover }}
                </div>
                <div class="font-weight-bold">
                  {{ i18n('calendar.duration.short', ['' + monthObj.timestart]) }}
                </div>
              </div>
              <div class="d-flex justify-content-between mb-2">
                <div class="fs-7">
                  {{ i18nstr.workmonth.cards.time.balance }}
                </div>
                <div class="font-weight-bold">
                  {{ i18n('calendar.duration.short', ['' + monthObj.timedif]) }}
                </div>
              </div>
              <div class="d-flex justify-content-between mb-2">
                <div class="fs-7">
                  {{ i18nstr.workmonth.cards.time.carryover }}
                </div>
                <div class="font-weight-bold">
                  {{ i18n('calendar.duration.short', ['' + monthObj.timeclose]) }}
                </div>
              </div>
            </div>
          </div>
        </div><!-- card 2: time booked -->

        <div class="col-12 col-md-4">
          <!-- card 3: day information -->
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <app-icon [iconClass]="icons['today']" [marginEnd]="1"></app-icon>
                {{ i18n('workmonth.cards.day.title', [f(s2d(selectedDay.date), 'P')]) }}
              </h5>
            </div>
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div class="fs-7">
                  {{ i18nstr.calendar.weekday }}
                </div>
                <div class="font-weight-bold">
                  <strong>{{ f(s2d(selectedDay.date), 'EEEE') }}</strong>
                </div>
              </div>
              <div class="d-flex justify-content-between" *ngIf="selectedDay.offcategory">
                <div class="fs-7">
                  {{ i18nstr.work.offcategories.title }}
                </div>
                <div class="font-weight-bold">
                  <strong>{{ i18n('work.offcategories.' + selectedDay.offcategory.name) }}</strong>
                </div>
              </div>
              <ng-container *ngIf="selectedDay.stats">
                <div class="d-flex justify-content-between">
                  <div class="fs-7">
                    {{ i18nstr.workday.daycard.booked }}
                  </div>
                  <div class="font-weight-bold">
                    <strong>{{ fd(selectedDay.stats.duration) }}</strong>
                    <span class="fs-8 ms-2"
                      *ngIf="usersettingsObj.work.worktime.default > selectedDay.stats.duration">[{{
                      fd(selectedDay.stats.duration - usersettingsObj.work.worktime.default) }}]</span>
                    <span class="fs-8 ms-2"
                      *ngIf="usersettingsObj.work.worktime.default < selectedDay.stats.duration">[+{{
                      fd(selectedDay.stats.duration - usersettingsObj.work.worktime.default) }}]</span>
                  </div>
                </div>
              </ng-container>
              <ng-container *ngIf="selectedDay.daytimeStats">
                <div class="mt-2 border-bottom"></div>
                <div class="row mt-2 fs-8">
                  <div class="col-3 text-center"><strong>{{ i18nstr.workday.tracking.common.from }}</strong></div>
                  <div class="col-3 text-center"><strong>{{ i18nstr.workday.tracking.common.until }}</strong></div>
                  <div class="col-3 text-center"><strong>{{ i18nstr.workday.tracking.common.breakShort }}</strong></div>
                  <div class="col-3 text-center"><strong>{{ i18nstr.workday.tracking.common.durationShort }}</strong>
                  </div>
                </div>
                <div class="row fs-8">
                  <div class="col-3 text-center">{{ f(s2d(selectedDay.daytimeStats.startOfDay), 'p') }}</div>
                  <div class="col-3 text-center">{{ f(s2d(selectedDay.daytimeStats.endOfDay), 'p') }}</div>
                  <div class="col-3 text-center">{{ fd(selectedDay.daytimeStats.breaksDuration) }}</div>
                  <div class="col-3 text-center">{{ fd(selectedDay.daytimeStats.totalDurationWithBreaks) }}</div>
                </div>
              </ng-container>
            </div>
          </div>
        </div><!-- card 3: day information -->

      </div><!-- container with month calendar -->

    </div>

    <div class="container pt-4 pt-md-2 mb-2">
      <div class="pb-2 border-bottom border-secondary border-2 d-flex justify-content-between">
        <h3>{{ i18nstr.workmonth.calendar.title }}</h3>
        <div>
          <nav class="h-100" style="--bs-breadcrumb-divider: '';" aria-label="breadcrumb">
            <ol class="breadcrumb d-flex align-items-center h-100 mb-0">
              <li class="breadcrumb-item">
                <button type="button" class="btn btn-sm btn-secondary"
                  (click)="usersettingsObj.view.calendar.showWeekend = !usersettingsObj.view.calendar.showWeekend; pushUserSettings();"
                  [title]="i18nstr.calendar.showWeekendTitle">
                  <app-icon [iconClass]="icons[usersettingsObj.view.calendar.showWeekend ? 'toggle-on' : 'toggle-off']"
                    [marginEnd]="1"></app-icon>
                  {{ i18nstr.calendar.showWeekend }}
                </button>
              </li>
            </ol>
          </nav>
        </div>
      </div>
    </div>

    <div class="container pt-md-2 mb-2">

      <div
        class="container-fluid p-0 mb-3 mb-md-1 d-flex flex-column flex-md-row justify-content-end align-items-center flex-wrap">
        <!-- Offtime categories drag&drop-->
        <div class="me-3">
          {{ i18nstr.workmonth.offtime.title }}<i [ngClass]="[icons['help'], 'fs-8 me-1 help-icon pointer']"
            [tooltip]="i18nstr.workmonth.offtime.subtitle"></i>:
        </div>
        <nav class="h-100" style="--bs-breadcrumb-divider: '';" aria-label="breadcrumb">
          <ol class="breadcrumb d-flex align-items-center h-100 mb-0">
            <ng-container *ngFor="let item of offdayDroppableEvents">
              <li class="breadcrumb-item" *ngIf="item.meta.obj.quickselect">
                <button type="button"
                  [ngClass]="['btn btn-sm btn-outline-primary py-2 py-md-0', item.meta.obj.rowcolor]" mwlDraggable
                  [dropData]="{ event: item }" [touchStartLongPress]="{ delay: 300, delta: 30 }"
                  dragActiveClass="drag-active">
                  <app-icon [iconClass]="icons[item.meta.obj.icon]" [addCssClasses]="item.meta.obj.iconcolor"
                    [marginEnd]="1" *ngIf="item.meta.obj.icon !== ''"></app-icon>
                  {{ item.title }}
                </button>
              </li>
            </ng-container>
          </ol>
        </nav>
        <!-- Offtime categories drag&drop-->
      </div>

      <div class="border my-3">
        <mwl-calendar-month-view [activeDayIsOpen]="activeDayIsOpen" [viewDate]="viewDate" [events]="calendarEvents"
          [excludeDays]="(usersettingsObj.view.calendar.showWeekend ? [] : [0,6])" [refresh]="refresh"
          [weekStartsOn]="usersettingsObj.view.calendar.firstDayOfWeek"
          (beforeViewRender)="beforeMonthViewRender($event)" (dayClicked)="dayClicked($event.day)"
          (eventClicked)="handleEvent('Clicked', $event.event)" (eventTimesChanged)="eventTimesChanged($event)"
          [locale]="locale">
        </mwl-calendar-month-view>
      </div>

    </div>

  </ng-container>

</ng-container>